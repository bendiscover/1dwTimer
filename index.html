<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1 Day Wraps Multi-Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding-top: 2rem;
            background: linear-gradient(to bottom, #2c2c2c, #1a1a1a);
            color: #ffffff;
        }
        #logo {
            max-width: 300px;
            margin-bottom: 3rem;
        }
        .timer-columns {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            width: 100%;
            position: relative;
        }
        .timer-column {
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 1.5rem;
            width: 320px;
            position: relative;
        }
        .timer-display {
            font-size: 4rem;
            margin: 1rem 0;
            color: #4CAF50;
            text-align: center;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1rem;
        }
        .input-group label {
            margin-bottom: 0.5rem;
            color: #cccccc;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        button {
            font-size: 1rem;
            padding: 0.5rem;
            background-color: #333333;
            color: #ffffff;
            border: 1px solid #555555;
            cursor: pointer;
        }
        button:hover {
            background-color: #444444;
        }
        .start, .stop {
            font-size: 1.2rem;
            padding: 0.7rem 1.5rem;
            margin: 0 0.5rem;
        }
        .start { background-color: #4CAF50; color: white; }
        .stop { background-color: #f44336; color: white; }
        .selected {
            background-color: #4CAF50;
            color: white;
        }
        #add-column {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4CAF50;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            cursor: pointer;
        }
        #add-column:hover {
            background-color: #45a049;
        }
        .name-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }
        .column-title {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .close-button {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: #ffffff;
            cursor: pointer;
        }
        .control-buttons {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }
        .sound-test {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .sound-test:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <img id="logo" src="1daywraps.png" alt="1 Day Wraps Logo">
    <div class="timer-columns" id="timer-columns"></div>
    <button class="sound-test" id="test-sound">Test Alarm Sound!</button>

    <audio id="alarm-sound" src="TimerComplete02.wav" preload="auto"></audio>
    <audio id="warning-sound" src="Fantasy SFX 002.wav" preload="auto"></audio>

    <script>
        const timerColumns = document.getElementById('timer-columns');
        const alarmSound = document.getElementById('alarm-sound');
        const warningSound = document.getElementById('warning-sound');
        const testSoundButton = document.getElementById('test-sound');

        testSoundButton.addEventListener('click', () => {
            playAlarmSound();
        });

        function playAlarmSound() {
            console.log('Attempting to play alarm sound');
            if (alarmSound.readyState === 4) {
                alarmSound.currentTime = 0;
                alarmSound.play().then(() => {
                    console.log('Alarm sound played successfully');
                }).catch(error => {
                    console.error('Error playing alarm:', error);
                });
            } else {
                console.log('Alarm sound not ready, waiting...');
                alarmSound.addEventListener('canplaythrough', () => {
                    alarmSound.currentTime = 0;
                    alarmSound.play().then(() => {
                        console.log('Alarm sound played successfully after waiting');
                    }).catch(error => {
                        console.error('Error playing alarm after waiting:', error);
                    });
                }, { once: true });
            }
        }

        function playWarningSound() {
            console.log('Attempting to play warning sound');
            if (warningSound.readyState === 4) {
                warningSound.currentTime = 0;
                warningSound.play().then(() => {
                    console.log('Warning sound played successfully');
                }).catch(error => {
                    console.error('Error playing warning:', error);
                });
            } else {
                console.log('Warning sound not ready, waiting...');
                warningSound.addEventListener('canplaythrough', () => {
                    warningSound.currentTime = 0;
                    warningSound.play().then(() => {
                        console.log('Warning sound played successfully after waiting');
                    }).catch(error => {
                        console.error('Error playing warning after waiting:', error);
                    });
                }, { once: true });
            }
        }

        function formatButtonLabel(minutes) {
            if (minutes < 60) {
                return minutes + 'm';
            } else {
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                return remainingMinutes === 0 ? hours + 'h' : hours + 'h ' + remainingMinutes + 'm';
            }
        }

        function createButtons(container, max, callback) {
            const oneMinButton = document.createElement('button');
            oneMinButton.textContent = '1m';
            oneMinButton.addEventListener('click', () => callback(1));
            container.appendChild(oneMinButton);

            for (let i = 5; i <= max; i += (i < 60 ? 5 : 10)) {
                const button = document.createElement('button');
                button.textContent = formatButtonLabel(i);
                button.addEventListener('click', () => callback(i));
                container.appendChild(button);
            }
        }

        function createTimerColumn(isDefault = false) {
            const column = document.createElement('div');
            column.className = 'timer-column';
            
            const nameButtons = document.createElement('div');
            nameButtons.className = 'name-buttons';
            ['Ben', 'Chris', 'Andrew', 'Katie'].forEach(name => {
                const button = document.createElement('button');
                button.textContent = name;
                button.onclick = function() { 
                    this.classList.toggle('selected');
                    updateColumnTitle(column);
                };
                nameButtons.appendChild(button);
            });
            column.appendChild(nameButtons);

            const title = document.createElement('div');
            title.className = 'column-title';
            title.textContent = 'Timer';
            column.appendChild(title);

            if (!isDefault) {
                const closeButton = document.createElement('button');
                closeButton.className = 'close-button';
                closeButton.innerHTML = '&times;';
                closeButton.addEventListener('click', () => {
                    column.remove();
                    updateAddButtonPosition();
                });
                column.appendChild(closeButton);
            }

            const timerDisplay = document.createElement('div');
            timerDisplay.className = 'timer-display';
            timerDisplay.textContent = '00:00:00';
            column.appendChild(timerDisplay);

            const durationGroup = document.createElement('div');
            durationGroup.className = 'input-group';
            durationGroup.innerHTML = '<label>Timer Duration:</label>';
            const durationButtons = document.createElement('div');
            durationButtons.className = 'button-group';
            durationGroup.appendChild(durationButtons);
            column.appendChild(durationGroup);

            const warningGroup = document.createElement('div');
            warningGroup.className = 'input-group';
            warningGroup.innerHTML = '<label>Warning Time:</label>';
            const warningButtons = document.createElement('div');
            warningButtons.className = 'button-group';
            warningGroup.appendChild(warningButtons);
            column.appendChild(warningGroup);

            const controlButtons = document.createElement('div');
            controlButtons.className = 'control-buttons';
            const startButton = document.createElement('button');
            startButton.className = 'start';
            startButton.textContent = 'Start';
            const stopButton = document.createElement('button');
            stopButton.className = 'stop';
            stopButton.textContent = 'Stop';
            controlButtons.appendChild(startButton);
            controlButtons.appendChild(stopButton);
            column.appendChild(controlButtons);

            let totalSeconds = 0;
            let warningSeconds = 0;
            let isRunning = false;
            let warningTriggered = false;
            let countdown;

            function setDuration(minutes) {
                totalSeconds = minutes * 60;
                updateTimerDisplay();
                selectButton(durationButtons, minutes);
            }

            function setWarning(minutes) {
                warningSeconds = minutes * 60;
                selectButton(warningButtons, minutes);
            }

            function selectButton(container, value) {
                container.querySelectorAll('button').forEach(btn => {
                    btn.classList.toggle('selected', btn.textContent === formatButtonLabel(value));
                });
            }

            function startTimer() {
                if (!isRunning && totalSeconds > 0) {
                    isRunning = true;
                    warningTriggered = false;
                    keepScreenOn();
                    countdown = setInterval(() => {
                        if (totalSeconds <= warningSeconds && !warningTriggered) {
                            playWarningSound();
                            warningTriggered = true;
                        }

                        if (totalSeconds <= 0) {
                            console.log('Timer reached zero');
                            stopTimer();
                            playAlarmSound();
                        } else {
                            totalSeconds--;
                            updateTimerDisplay();
                        }
                    }, 1000);
                }
            }

            function stopTimer() {
                clearInterval(countdown);
                isRunning = false;
                allowScreenSleep();
            }

            function updateTimerDisplay() {
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                timerDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            createButtons(durationButtons, 120, setDuration);
            createButtons(warningButtons, 60, setWarning);

            startButton.addEventListener('click', startTimer);
            stopButton.addEventListener('click', stopTimer);

            setDuration(60);
            setWarning(20);

            timerColumns.appendChild(column);
            updateAddButtonPosition();
        }

        function updateColumnTitle(column) {
            const selectedNames = Array.from(column.querySelectorAll('.name-buttons .selected'))
                .map(button => button.textContent);
            const title = column.querySelector('.column-title');
            title.textContent = selectedNames.join(' & ') || 'Timer';
        }

        function updateAddButtonPosition() {
            let addButton = document.getElementById('add-column');
            if (!addButton) {
                addButton = document.createElement('button');
                addButton.id = 'add-column';
                addButton.textContent = '+';
                addButton.addEventListener('click', () => createTimerColumn(false));
                timerColumns.appendChild(addButton);
            }
            const lastColumn = Array.from(timerColumns.children).filter(child => child.className === 'timer-column').pop();
            if (lastColumn) {
                const rect = lastColumn.getBoundingClientRect();
                const containerRect = timerColumns.getBoundingClientRect();
                addButton.style.left = `${rect.right - containerRect.left + 20}px`;
                addButton.style.top = `${rect.top - containerRect.top + (rect.height / 2) - (addButton.offsetHeight / 2)}px`;
            } else {
                addButton.style.position = 'static';
                addButton.style.marginTop = '1rem';
            }
        }

        function keepScreenOn() {
            if (navigator.wakeLock) {
                navigator.wakeLock.request('screen').then(lock => {
                    console.log('Screen wake lock is active');
                }).catch(err => {
                    console.error(`${err.name}, ${err.message}`);
                });
            }
        }

        function allowScreenSleep() {
            if (navigator.wakeLock) {
                navigator.wakeLock.release('screen').then(() => {
                    console.log('Screen wake lock is released');
                }).catch(err => {
                    console.error(`${err.name}, ${err.message}`);
                });
            }
        }

        // Create default timer column
        createTimerColumn(true);
    </script>
</body>
</html>
